{% extends "base.html" %}

{% block title %} Introduction {% endblock %}

{% block user %}active{% endblock %}

{% block content %}

<div id="top_info" class="well green-well intro" style="width:100%;">
    <h2>Thanks for signing up!<br/>
        First, we need to get to know you better.</h2>
</div>  
{% if error %}
<div class="alert alert-error">  
    <a class="close" data-dismiss="alert">×</a>  
    <h4>Oops there has been an error! Just refill this out and you should be all set!</h4>
    Our trained monkeys are working on it right now.
</div> 
{% endif %}
<div id ="intro1" class="container">
<form id='user_info' class="form-inline" action='/user/update/' method="POST">
        <div class="row spaced-out">
        <div class="offset2 span4">
            <h4>My Current Finances</h4>
        </div>
        </div>
        <div class="row spaced-out">
        <div class="offset2">
        <div class="form-group">
            <label >I have $</label>
	        <input id="saved" name="saved" type="text" class="form-control" placeholder="e.g. 2000" ></input>
	        <label>saved up and $</label>
	        <input id="loans" name="loans" type="text" class="form-control" placeholder="e.g. 2000"></input>
	        <label> in student loans.</label>
        </div>
        </div>
        </div>
        <div class="row spaced-out">
        </div>
        <div class="row spaced-out">
        <div class="offset2 span4">
            <h4>My Education</h4>
        </div>
        </div>
        <div class="row spaced-out">
        <div class="offset2">
        <div class="form-group">
            <label>My Last School Term is</label>
	        <select id="end_term" name="end_term" class="form-control">
                <option value="1">Fall</option>
                <option value="2">Winter</option>
                <option value="3">Spring</option>
            </select>
	        <label>of</label>
	        <select id="end_year" name="end_year">
                <option value="2013">2013</option>
                <option value="2014">2014</option>
                <option value="2015">2015</option>
                <option value="2016">2016</option>
                <option value="2017">2017</option>
                <option value="2018">2018</option>
            </select>
        </div>
        </div>
        </div>
   <!-- <div class="row spaced-out">
        <div class="offset2 span4">
            <h4>How much money do you have saved up?</h4>
        </div>
        <div class="span6">
            <input id="saved" name="saved" type="text" class="input-small" placeholder="e.g. 3000"></input>
        </div>
    </div> -->
    <!--div class="row spaced-out">
        <div class="offset2 span4">
            <h4>How much can you make per term working part-time?</h4>
        </div>
        <div class="span6">
            <input id="part_time" name="part_time" type="text" placeholder="e.g. 5000"></input>
        </div>
    </div-->
    <!--<div class="row spaced-out">
        <div class="offset2 span4">
            <h4>Are you in a co-op program?</h4>
        </div>
        <div class="span3">
            <select id="coop" name="coop" >
                <option value="True">Yes</option>
                <option value="False">No</option>
            </select>
        </div>
    </div>-->

        <div class="row spaced-out">
        </div>
        <div class="row spaced-out">
        </div>
        <div class="row spaced-out" style="text-align:center;">
            <div class="offset2 span2">
                <a class="btn btn-large btn-block btn-primary" onclick="intro2();">Next!</a>
            </div>
        </div>
        <input type="hidden" id="sequence" name="sequence" value=""> </input>
        <input type="hidden" id="budgetType" name="budgetType" value=""> </input>
        <input type="hidden" id="subjectv" name="subjectv" value=""> </input>
        <input type="hidden" id="amountv" name="amountv" value=""> </input>
        <input type="hidden" id="oftenv" name="oftenv" value=""> </input>
        <input type="hidden" id="oftenav" name="oftenav" value=""> </input>
        <input type="hidden" id="rowLength" name="rowLength" value=""> </input>
</form>
</div>

<div id="intro2" style="display:none" class="container">
    <div class="alert">
        <a class="close" data-dismiss="alert">×</a>
        Click on the buttons to change your term type to work or study!
    </div>

    <div class="row spaced-out" style="text-align:center">
        <div class="offset1 span2"></div>
        <div class="span2"><h4>Fall</h4></div>
        <div class="span2"><h4>Winter</h4></div>
        <div class="span2"><h4>Spring</h4></div>
    </div>

    <div id="intro2_sequence"></div>

    <div class="row spaced-out" style="text-align:center;">
        <div class="offset3 span3">
            <a class="btn btn-large btn-block btn-primary" onclick="intro1();">Back</a>
        </div>
        <div class="span3">
            <a class="btn btn-large btn-block btn-primary" onclick="intro3();">Next!</a>
        </div>
    </div>
</div>
<div id="intro3" style="display:none" class="container">
    <div class="span12 bordered">
        <table id="uTable" class="table fixed" style="width:95%;">
            <thead>
                <tr>
                    <th>Type</th>
                    <th>Name</th>
                    <th>Amount</th>
                    <th>Frequency</th>
                    <th>Applicable Terms</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <select id="budget_type0" name="budget_type0">
                            <option value="1">Income</option>
                            <option value="2">Expense</option>
                        </select>
                    </td>
                    <td>
                        <input id="subject0" name="subject0" type="text" placeholder="Subject"></input>
                    </td>
                    <td>
                        <input id="amount0" name="amount0" type="text" placeholder="2000"></input>
                    </td>
                    <td>
                        <select id="often0" name="often0">
                            <option value="t">Per Term</option>
                            <option value="m">Per Month</option>
                            <option value="o">One Time</option>
                        </select>
                    </td>
                    <td>
                        <select id="oftena0" name="oftena0">
                            <option value="w">Work Term</option>
                            <option value="s">Study Term</option>
                            <option value="a">All Terms</option>
                        </select>
                    </td>
                </tr>
            </tbody>
        </table>
        <a id= "addrow" href=''
           >Add Author</a>
        <input type="hidden" id="rowCounter" name="rowCounter" value="0"> </input>
    </div>
    <div class="span3">
         <a class="btn btn-large btn-block btn-primary" onclick="form_submit();">Next!</a>
    </div>
</div>

<script type="text/javascript">
function form_submit() {
    $('#user_info').submit();
}
$("#addrow").on("click", function () {
    var counter = $('#uTable tr').length-1;
    var budgetTypeId = "budget_type"+counter;
    var subjectId = "subject"+counter;
    var amountId = "amount"+counter;
    var oftenId = "often"+counter;
    var oftenaId = "oftena"+counter;
     $('#rowCounter').val(counter+1);
     var test =  $('#rowCounter').val();
    var count = $('#uTable').children().length;
    var cols = "";
    var newRow = $("<tr>");
    cols += '<td><select id="' + budgetTypeId + '" name="' + budgetTypeId + '"><option value="1">Income</option><option value="2">Expense</option> </select></td>';
    cols += '<td><input type="text" id="' + subjectId + '" name="' + subjectId + '"></input></td>';
    cols += '<td><input type="text" id="' + amountId + '" name="' + amountId + '" placeholder="' + test + '" ></input></td>';
    cols += '<td><select id="' + oftenId + '" name="' + oftenId + '"><option>Per Term</option> </select></td>';
    cols += '<td><select id="' + oftenaId + '" name="' + oftenaId + '"><option>Work Term</option> <option>Study Term</option><option>Off</option></select></td>';
    newRow.append(cols);

    $('#uTable').append(newRow);

    counter ++;
   return false;

});
function change(year, term) {
    var val = $('#' + year + '_' + term).text();
    if (val == "Study") {
        if($('#coop').val() == "True") {
            $('#' + year + '_' + term).text('Work');
        }else{
            $('#' + year + '_' + term).text('Off');
        }
        $('#' + year + '_' + term).addClass('btn-info');
        $('#' + year + '_' + term).removeClass('btn-primary');
    } else {
        $('#' + year + '_' + term).text('Study');
        $('#' + year + '_' + term).removeClass('btn-info');
        $('#' + year + '_' + term).addClass('btn-primary');
    }
}

function intro1(){
    $('#intro2').hide();
    $('#intro1').show();
}

function intro2(){
    $('#intro1').hide();
    $('#intro2').show();
    var end = $('#end_year').val();
    var start = parseInt(end)-5;
    var check = true;
    var endTerm = $('#end_term').val();
    var endTerm1 = parseInt(endTerm);
    $('#intro2_sequence').empty();
    for (var year = start; year<end; year++) {
        var next = parseInt(year)+1;
        $('#intro2_sequence').append('<div id="sequence_'+year+'" class="row spaced-out"><div class="offset1 span2"><h3>'+year + '/' + next +'</h3></div></div>');
        for (var term =0;term <3;term++) {
            var style="btn-primary";
            var type="Study";
            var toggle = '<div class="span2"><div class="row spaced out"><select id="'+year+'_'+term+'" class="row-fluid span8" ><option >Work</option><option>Study</option><option >Off</option></select></div></div>';
	        if(end == next && endTerm1 == term)
	        {
	           check = false;
	        }
	        if (check ==false)
	        {
	           toggle = '<div class="span2"><div class="row spaced out"><select disabled id="'+year+'_'+term+'" class="row-fluid span8" ><option >Off</option><option>Study</option><option >Work</option></select></div></div>';
	        }
	        $('#sequence_'+year).append(toggle);
	        }

	    }

    }


function intro3(){
    $('#intro2').hide();
    $('#intro3').show();
}


$(function(){
    $('#intro2').hide();
    $('#intro3').hide();
    $('#user_info').submit(function(){
    var end = $('#end_year').val();
    var start = parseInt(end)-5;
        var sequence = '';
        for (var year = start; year<end; year++) {
            for (var term =0;term <3;term++) {
                var val = $('#'+year+'_'+term).find('option:selected').text();
                if (val == 'Study') {
                    sequence += 'S';
                } else if (val == 'Work') {
                    sequence += 'W';
                } else if (val == 'Off') {
                    sequence += 'O';
                }
            }
        }
        var totalRows = $('#rowCounter').val();
        if (totalRows == 0)
        {
         totalRows =1;
        }
        var budgetType = '';
        var subject = '';
        var amount = '';
        for (var initialRow = 0; initialRow<totalRows; initialRow++) {
         var val1 = $('#budget_type'+initialRow).val();
         var val2 = $('#subject'+initialRow).val();
         var val3 = $('#amount'+initialRow).val();
         if(val1== 1){
            budgetType += 'I';
         } else if (val1 == 2) {
            budgetType += 'E';
         }

        if (initialRow ==0){
            subject += val2;
            amount += val3;
        }
        else {
            subject += ','+val2;
            amount += ',' +val3;
        }


        }

        $('#budgetType').val(budgetType);
        $('#subjectv').val(subject);
        $('#amountv').val(amount);
        $('#rowLength').val(totalRows);

        $('#sequence').val(sequence);
        if(!$('#saved').val()) {
            alert("Please Fill in amount Saved!");
            return false;
        }
        if(!$('#loans').val()) {
            alert("Please Fill In Your Loans!");
            return false;
        }
        return true;
    })
});

</script>


{% endblock %}
